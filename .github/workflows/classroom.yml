# .github/classroom.yml
# GitHub Classroom Autograding Configuration

name: "Temperature and Circle Area Assignment"

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout student repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: |
          npm install jsdom jest --save-dev

      - name: Create test file
        run: |
          mkdir -p __tests__
          cat > __tests__/script.test.js <<'EOF'
          const fs = require("fs");
          const { JSDOM } = require("jsdom");

          describe("Temperature and Circle Area Conversion (DOM Output)", () => {
            let dom, document, window;

            beforeEach(() => {
              const html = `
                <!DOCTYPE html>
                <html>
                  <body>
                    <input id="temp" value="212">
                    <input id="radius" value="5">
                    <div id="tempC"></div>
                    <div id="area"></div>
                    <script src="../script.js"></script>
                  </body>
                </html>`;
              dom = new JSDOM(html, { runScripts: "dangerously", resources: "usable" });
              document = dom.window.document;
              window = dom.window;
            });

            test("should have output elements with ids tempC and area", () => {
              expect(document.getElementById("tempC")).not.toBeNull();
              expect(document.getElementById("area")).not.toBeNull();
            });

            test("should correctly convert Fahrenheit to Celsius and display it", () => {
              const scriptContent = fs.readFileSync("script.js", "utf-8");
              eval(scriptContent);

              const tempInput = document.getElementById("temp");
              tempInput.value = "212"; // 212°F → 100°C

              // Call calculate if defined
              if (typeof window.calculate === "function") window.calculate();

              const outputText = document.getElementById("tempC").textContent.trim();
              const celsius = parseFloat(outputText);
              expect(Math.abs(celsius - 100)).toBeLessThan(0.5);
            });

            test("should correctly calculate circle area and display it", () => {
              const scriptContent = fs.readFileSync("script.js", "utf-8");
              eval(scriptContent);

              const radiusInput = document.getElementById("radius");
              radiusInput.value = "5"; // Expected area ≈ 78.54

              if (typeof window.calculate === "function") window.calculate();

              const outputText = document.getElementById("area").textContent.trim();
              const areaValue = parseFloat(outputText);
              const expectedArea = Math.PI * Math.pow(5, 2);
              expect(Math.abs(areaValue - expectedArea)).toBeLessThan(0.5);
            });
          });
          EOF

      - name: Run Jest tests
        run: npx jest --runInBand --verbose
